#
# CMSSW cfg file for HLT JetMET trigger paths.  Assumes jet reconstruction has 
# already been carried out
#
process MinBiasHLT  = {

    source = PoolSource { 
      untracked vstring fileNames = {
       "/store/mc/2007/1/26/mc-onsel-120_PU_Minbias-DIGI-RECO-NoPU/0000/00950641-F1B3-DB11-80AA-0002B3D90DEF.root"}
      untracked int32 maxEvents = 20
    }

#    include "SimGeneral/HepPDTESSource/data/pdt.cfi"

    include "HLTrigger/Configuration/data/common/Level1Trigger.cff"

##    the following to use l1extramctruth
#     module l1MinBias =  hltLevel1Seed from "HLTrigger/HLTexample/data/hltLevel1Seed.cfi"
#     replace l1MinBias.L1Seeds = {"MinBias"}
#     sequence L1TSeq = {l1extramctruth, l1MinBias}

#    the following to use l1 emulator
     module l1MinBias =  hltLevel1Seed from "HLTrigger/HLTexample/data/hltLevel1Seed.cfi"
     replace l1MinBias.L1Seeds = {"MinBias"}
     replace l1MinBias.L1ExtraCollections = l1extraParticles
     replace l1MinBias.L1ExtraParticleMap = l1extraParticleMap
     replace l1MinBias.L1GTReadoutRecord = l1extraParticleMap
     sequence L1TSeq = {doL1T, l1MinBias}

#     does not work with 1_3_x (should work with 1_4_x), replacing stuff above.
#     include "HLTrigger/special/data/SimpleBias.cff"
#     sequence L1TSeq = {doL1T, l1sZero}


#   do global pixel track reconstruction
    include "HLTrigger/special/test/MinBias-Pixel-Reco.cff"

#   convert all pixel tracks to RecoChargedCandidates
    module hltPixlCands = ConcreteChargedCandidateProducer{
       InputTag src = pixelTracks
#      just pretend tracks are pi+, many will not really be...
       string particleType = "pi+"
    }

#   do the filter work 
    module hltPixlMBFilt = HLTPixlMBFilt{
       InputTag pixlTag = hltPixlCands
       double   MinPt  = 0.0                  // MinPt currently not used (all pt accepted)
       uint32   MinTrks = 2                   // Number of tracks from same vertex
       double   MinSep = 1.0                  // minimum eta-phi separation between tracks
    }


    untracked PSet options = {
	untracked bool wantSummary = true  # default is false
	untracked bool makeTriggerResults = true
	vstring listOfTriggers = {"*"}  # get results for all triggers
    }

    module glob = HLTMakeSummaryObjects { }

    module out = PoolOutputModule {
	untracked string fileName = "hlt_MB_test.root"
	untracked vstring outputCommands =
	{ # drop a bunch of branches to keep output file size reasonable
	    "drop *",
	    "keep recoHLTFilterObjectBase_*_*_*",
	    "keep recoHLTFilterObjectWithRefs_*_*_*",
	    "keep recoHLTPathObject_*_*_*",
	    "keep recoHLTGlobalObject_*_*_*",
	    "keep recoVertex_*_*_*",
	    "keep recoTracks_*_*_*",
	    "keep recoTrackExtras_*_*_*",
	    "keep TrajectorySeeds_*_*_*",
	    "keep SimTracks_*_*_*",
	    "keep SimVertex_*_*_*",
	    "keep recoRecoChargedCandidates_*_*_*",
	    "keep l1extraL1ParticleMaps_*_*_*",
	    "keep edmHepMCProduct_*_*_*",
	    "keep edmTriggerResults_*_*_*"
	}
    }

// HLT trigger paths

//    this path without using prescale at L1
//    path HLTMBPIX = { siPixelClusters, siPixelRecHits, pixelTracks &  hltPixlCands & hltPixlMBFilt}
//  this path to use a prescale at L1 (normally should be ~BX-rate, i.e. ~4E7 @ 1E34)
    path HLTMBPIX = {L1TSeq, siPixelClusters, siPixelRecHits, pixelTracks, hltPixlCands & hltPixlMBFilt}

    endpath outpath = { glob, out }
}
